# create kind cluster
kind create cluster --config ~/git/ldk/kind-cluster/klc.yaml

# to delete cluster
sysuser@ubuntudev:~$ kind delete cluster --name=klc

# shell into the control plane
docker exec -it klc-control-plane bash

# stop kind containers
docker stop $(docker ps -q --filter "name=klc")

# to start kind containers
docker start $(docker ps -aq --filter "name=klc")

# port forward all traffic to 8001 on localhost
kubectl proxy --port=8001

# combine into one line to disown the process
sysuser@ubuntudev:~$ (kubectl proxy --port=8001 &); sleep 2; disown

# get the pid to kill the process if needed
sysuser@ubuntudev:~$ ps aux | grep 8001

## Cloud Provider KIND ##
# https://kind.sigs.k8s.io/docs/user/loadbalancer/
go install sigs.k8s.io/cloud-provider-kind@latest

# add to path
echo 'export PATH=$PATH:$HOME/go/bin' >> ~/.bashrc
source ~/.bashrc

# run this to detach the terminal
cloud-provider-kind --enable-lb-port-mapping > ~/go/bin/cloud-provider-kind.log 2>&1 &

# disown so that the terminal can be closed
disown

# ensure that the process is still running
sysuser@ubuntudev:~$ ps aux | grep cloud-provider-kind

# to stop the service
ps aux | grep cloud-provider-kind
kill <PID>
